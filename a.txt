Not: Ekran.Dönem ekrandaki seçilen dönem demektir. Buna göre değer değişir.

Nakit Girişi Toplam
SELECT sum(Tutar) FROM SilverCloud.Nakit
where Tip='Bankaya Yatan'
And Donem =Ekran.Donem;

Örnek Donem =2507
SELECT sum(Tutar) FROM SilverCloud.Nakit
where Tip='Bankaya Yatan'
And Donem = 2507
------------------------
Bankaya Yatan Toplam
SELECT Sum(Tutar) FROM SilverCloud.Odeme
where Donem = Ekran.Donem
And Kategori_ID = (
select Kategori_ID from Kategori
where Kategori_Adi ='ATM Para Yatırma' )


Örnek Donem =2509
SELECT Sum(Tutar) FROM SilverCloud.Odeme
where Donem = 2509
And Kategori_ID = (
select Kategori_ID from Kategori
where Kategori_Adi ='ATM Para Yatırma' )
-----------------------
Gelir POS
SELECT
    SUM(Tutar) AS Nakit
FROM SilverCloud.Gelir
WHERE DATE_FORMAT(Tarih, '%y%m')=Ekran.Donem
  AND Kategori_ID = (
        SELECT Kategori_ID
        FROM SilverCloud.Kategori
        WHERE Kategori_Adi = 'POS'
	);
Örnek Donem =2509
SELECT
    SUM(Tutar) AS Nakit
FROM SilverCloud.Gelir
WHERE DATE_FORMAT(Tarih, '%y%m')=2509
  AND Kategori_ID = (
        SELECT Kategori_ID
        FROM SilverCloud.Kategori
        WHERE Kategori_Adi = 'POS'
	);

-------------------------
POS Hareketleri






---------------------
Online Gelir Toplam
SELECT
    SUM(Tutar) AS Online_Satis_Gelirleri
FROM SilverCloud.Gelir
WHERE DATE_FORMAT(Tarih, '%y%m')=Ekran.Donem
  AND Kategori_ID IN (
        SELECT Kategori_ID
        FROM SilverCloud.Kategori
        WHERE Ust_Kategori_ID IN (
            SELECT UstKategori_ID
            FROM SilverCloud.UstKategori
            WHERE UstKategori_Adi ='E-Ticaret Kredi Kart'
        )
  );

Örnek Donem =2507
SELECT
    SUM(Tutar) AS Online_Satis_Gelirleri
FROM SilverCloud.Gelir
WHERE DATE_FORMAT(Tarih, '%y%m')=2507
  AND Kategori_ID IN (
        SELECT Kategori_ID
        FROM SilverCloud.Kategori
        WHERE Ust_Kategori_ID IN (
            SELECT UstKategori_ID
            FROM SilverCloud.UstKategori
            WHERE UstKategori_Adi ='E-Ticaret Kredi Kart'
        )
  );

---------------------
Online Virman Toplam
SELECT * FROM SilverCloud.B2B_Ekstre
where Aciklama like '%Online Alacak Virman%'
and donem =Ekran.Dönem;

Örnek Donem =2507
SELECT * FROM SilverCloud.B2B_Ekstre
where Aciklama like '%Online Alacak Virman%'
and donem =2508;

--------------------------
Yemek Çeki Aylık Gelir
SELECT
    SUM(Tutar) AS Online_Satis_Gelirleri
FROM SilverCloud.Gelir
WHERE DATE_FORMAT(Tarih, '%y%m')=Ekran.Donem
  AND Kategori_ID IN (
        SELECT Kategori_ID
        FROM SilverCloud.Kategori
        WHERE Ust_Kategori_ID IN (
            SELECT UstKategori_ID
            FROM SilverCloud.UstKategori
            WHERE UstKategori_Adi ='Yemek Çeki'
        )
  );

Örnek Donem =2507
SELECT
    SUM(Tutar) AS Online_Satis_Gelirleri
FROM SilverCloud.Gelir
WHERE DATE_FORMAT(Tarih, '%y%m')=2507
  AND Kategori_ID IN (
        SELECT Kategori_ID
        FROM SilverCloud.Kategori
        WHERE Ust_Kategori_ID IN (
            SELECT UstKategori_ID
            FROM SilverCloud.UstKategori
            WHERE UstKategori_Adi ='Yemek Çeki'
        )
  );




--------------------

Yemek Çeki Dönem Toplamı

WITH Aktif_YemekCeki AS (
    SELECT
        Kategori_ID,
        Ilk_Tarih,
        Son_Tarih,
        Tutar
    FROM SilverCloud.Yemek_Ceki
    WHERE CAST(DATE_FORMAT(Ilk_Tarih, '%y%m') AS UNSIGNED) <= Ekran.Donem
      AND CAST(DATE_FORMAT(Son_Tarih, '%y%m') AS UNSIGNED) >= Ekran.Donem
),
Excluded AS (
    SELECT
        SUM(g.Tutar) AS Excluded_Tutar
    FROM Aktif_YemekCeki y
    JOIN SilverCloud.Gelir g
      ON g.Kategori_ID = y.Kategori_ID
     AND CAST(DATE_FORMAT(g.Tarih, '%y%m') AS UNSIGNED) <> Ekran.Donem
     AND g.Tarih >= y.Ilk_Tarih
     AND g.Tarih <= y.Son_Tarih
),
Included AS (
    SELECT
        SUM(Tutar) AS Included_Tutar
    FROM Aktif_YemekCeki
)
SELECT
    i.Included_Tutar - COALESCE(e.Excluded_Tutar,0) AS Donem_Tutar
FROM Included i
CROSS JOIN Excluded e;



Örnek Dönem 2508 seçilirse

WITH Aktif_YemekCeki AS (
    SELECT
        Kategori_ID,
        Ilk_Tarih,
        Son_Tarih,
        Tutar
    FROM SilverCloud.Yemek_Ceki
    WHERE CAST(DATE_FORMAT(Ilk_Tarih, '%y%m') AS UNSIGNED) <= 2508
      AND CAST(DATE_FORMAT(Son_Tarih, '%y%m') AS UNSIGNED) >= 2508
),
Excluded AS (
    SELECT
        SUM(g.Tutar) AS Excluded_Tutar
    FROM Aktif_YemekCeki y
    JOIN SilverCloud.Gelir g
      ON g.Kategori_ID = y.Kategori_ID
     AND CAST(DATE_FORMAT(g.Tarih, '%y%m') AS UNSIGNED) <> 2508
     AND g.Tarih >= y.Ilk_Tarih
     AND g.Tarih <= y.Son_Tarih
),
Included AS (
    SELECT
        SUM(Tutar) AS Included_Tutar
    FROM Aktif_YemekCeki
)
SELECT
    i.Included_Tutar - COALESCE(e.Excluded_Tutar,0) AS Donem_Tutar
FROM Included i
CROSS JOIN Excluded e;






------
Kullanılamayacak ama Yemek Çeki detay Görmek için lazım olabilir

WITH Aktif_YemekCeki AS (
    SELECT
        Kategori_ID,
        Tutar,
        Ilk_Tarih,
        Son_Tarih
    FROM SilverCloud.Yemek_Ceki
    WHERE CAST(DATE_FORMAT(Ilk_Tarih, '%y%m') AS UNSIGNED) <= 2508
      AND CAST(DATE_FORMAT(Son_Tarih, '%y%m') AS UNSIGNED) >= 2508
),
Excluded AS (
    SELECT
        y.Kategori_ID,
        SUM(g.Tutar) AS Excluded_Tutar
    FROM Aktif_YemekCeki y
    JOIN SilverCloud.Gelir g
      ON g.Kategori_ID = y.Kategori_ID
     AND CAST(DATE_FORMAT(g.Tarih, '%y%m') AS UNSIGNED) <> 2508
     AND g.Tarih >= y.Ilk_Tarih
     AND g.Tarih <= y.Son_Tarih
    GROUP BY y.Kategori_ID
),
Included AS (
    SELECT
        y.Kategori_ID,
        SUM(y.Tutar) AS Included_Tutar
    FROM Aktif_YemekCeki y
    GROUP BY y.Kategori_ID
)
SELECT
    i.Kategori_ID,
    i.Included_Tutar,
    COALESCE(e.Excluded_Tutar,0) AS Excluded_Tutar,
    i.Included_Tutar - COALESCE(e.Excluded_Tutar,0) AS Donem_Tutar
FROM Included i
LEFT JOIN Excluded e
  ON i.Kategori_ID = e.Kategori_ID;



