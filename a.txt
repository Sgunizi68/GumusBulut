Not: Ekran.Yil ekrandaki seçilen Yıl  ve Ekran.Sube_ID ekrandaki şube kodu demektir.
Örneğin Ekran.Yıl = 2025 ve Ekran.Sube_ID = 1 olabilir
--------------------------
Su

SET @DYil = Ekran.Yil;
SET @Sube_ID = Ekran.Sube_ID;

WITH MatchingKategori AS (
    SELECT Kategori_ID
    FROM SilverCloud.Kategori
    WHERE Kategori_Adi = 'Su'
),
tumunu_veriler AS (
    SELECT dh.Donem, SUM(dh.Tutar) AS Tutar
    FROM SilverCloud.Diger_Harcama dh
    JOIN MatchingKategori k ON dh.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(dh.Donem, '01'), '%y%m%d')) = @DYil
      AND dh.Sube_ID = @Sube_ID
    GROUP BY dh.Donem

    UNION ALL

    SELECT ef.Donem, SUM(ef.Tutar) AS Tutar
    FROM SilverCloud.e_Fatura ef
    JOIN MatchingKategori k ON ef.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(ef.Donem, '01'), '%y%m%d')) = @DYil
      AND ef.Sube_ID = @Sube_ID
    GROUP BY ef.Donem
)
SELECT Donem, COALESCE(SUM(Tutar), 0) AS Toplam_Tutar
FROM tumunu_veriler
GROUP BY Donem
ORDER BY Donem;


--------------------------
Elektrik


SET @DYil = Ekran.Yil;
SET @Sube_ID = Ekran.Sube_ID;

WITH MatchingKategori AS (
    SELECT Kategori_ID
    FROM SilverCloud.Kategori
    WHERE Kategori_Adi = 'Elektrik'
),
tumunu_veriler AS (
    SELECT dh.Donem, SUM(dh.Tutar) AS Tutar
    FROM SilverCloud.Diger_Harcama dh
    JOIN MatchingKategori k ON dh.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(dh.Donem, '01'), '%y%m%d')) = @DYil
      AND dh.Sube_ID = @Sube_ID
    GROUP BY dh.Donem

    UNION ALL

    SELECT ef.Donem, SUM(ef.Tutar) AS Tutar
    FROM SilverCloud.e_Fatura ef
    JOIN MatchingKategori k ON ef.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(ef.Donem, '01'), '%y%m%d')) = @DYil
      AND ef.Sube_ID = @Sube_ID
    GROUP BY ef.Donem
)
SELECT Donem, COALESCE(SUM(Tutar), 0) AS Toplam_Tutar
FROM tumunu_veriler
GROUP BY Donem
ORDER BY Donem;
--------------------------
Doğalgaz Gideri


SET @DYil = Ekran.Yil;
SET @Sube_ID = Ekran.Sube_ID;

WITH MatchingKategori AS (
    SELECT Kategori_ID
    FROM SilverCloud.Kategori
    WHERE Kategori_Adi = 'Doğalgaz Gideri'
),
tumunu_veriler AS (
    SELECT dh.Donem, SUM(dh.Tutar) AS Tutar
    FROM SilverCloud.Diger_Harcama dh
    JOIN MatchingKategori k ON dh.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(dh.Donem, '01'), '%y%m%d')) = @DYil
      AND dh.Sube_ID = @Sube_ID
    GROUP BY dh.Donem

    UNION ALL

    SELECT ef.Donem, SUM(ef.Tutar) AS Tutar
    FROM SilverCloud.e_Fatura ef
    JOIN MatchingKategori k ON ef.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(ef.Donem, '01'), '%y%m%d')) = @DYil
      AND ef.Sube_ID = @Sube_ID
    GROUP BY ef.Donem
)
SELECT Donem, COALESCE(SUM(Tutar), 0) AS Toplam_Tutar
FROM tumunu_veriler
GROUP BY Donem
ORDER BY Donem;



--------------------------
İnternet ve Telefon


SET @DYil = Ekran.Yil;
SET @Sube_ID = Ekran.Sube_ID;

WITH MatchingKategori AS (
    SELECT Kategori_ID
    FROM SilverCloud.Kategori
    WHERE Kategori_Adi = 'İnternet ve Telefon'
),
tumunu_veriler AS (
    SELECT dh.Donem, SUM(dh.Tutar) AS Tutar
    FROM SilverCloud.Diger_Harcama dh
    JOIN MatchingKategori k ON dh.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(dh.Donem, '01'), '%y%m%d')) = @DYil
      AND dh.Sube_ID = @Sube_ID
    GROUP BY dh.Donem

    UNION ALL

    SELECT ef.Donem, SUM(ef.Tutar) AS Tutar
    FROM SilverCloud.e_Fatura ef
    JOIN MatchingKategori k ON ef.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(ef.Donem, '01'), '%y%m%d')) = @DYil
      AND ef.Sube_ID = @Sube_ID
    GROUP BY ef.Donem
)
SELECT Donem, COALESCE(SUM(Tutar), 0) AS Toplam_Tutar
FROM tumunu_veriler
GROUP BY Donem
ORDER BY Donem;

-------------------------
Personel Yemek Giderleri


SET @DYil = Ekran.Yil;
SET @Sube_ID = Ekran.Sube_ID;

WITH MatchingKategori AS (
    SELECT Kategori_ID
    FROM SilverCloud.Kategori
    WHERE Kategori_Adi = 'Personel Yemek Giderleri'
),
tumunu_veriler AS (
    SELECT dh.Donem, SUM(dh.Tutar) AS Tutar
    FROM SilverCloud.Diger_Harcama dh
    JOIN MatchingKategori k ON dh.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(dh.Donem, '01'), '%y%m%d')) = @DYil
      AND dh.Sube_ID = @Sube_ID
    GROUP BY dh.Donem

    UNION ALL

    SELECT ef.Donem, SUM(ef.Tutar) AS Tutar
    FROM SilverCloud.e_Fatura ef
    JOIN MatchingKategori k ON ef.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(ef.Donem, '01'), '%y%m%d')) = @DYil
      AND ef.Sube_ID = @Sube_ID
    GROUP BY ef.Donem
)
SELECT Donem, COALESCE(SUM(Tutar), 0) AS Toplam_Tutar
FROM tumunu_veriler
GROUP BY Donem
ORDER BY Donem;

-------------------------
Temizlik Giderleri


SET @DYil = Ekran.Yil;
SET @Sube_ID = Ekran.Sube_ID;

WITH MatchingKategori AS (
    SELECT Kategori_ID
    FROM SilverCloud.Kategori
    WHERE Kategori_Adi = 'Temizlik Giderleri'
),
tumunu_veriler AS (
    SELECT dh.Donem, SUM(dh.Tutar) AS Tutar
    FROM SilverCloud.Diger_Harcama dh
    JOIN MatchingKategori k ON dh.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(dh.Donem, '01'), '%y%m%d')) = @DYil
      AND dh.Sube_ID = @Sube_ID
    GROUP BY dh.Donem

    UNION ALL

    SELECT ef.Donem, SUM(ef.Tutar) AS Tutar
    FROM SilverCloud.e_Fatura ef
    JOIN MatchingKategori k ON ef.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(ef.Donem, '01'), '%y%m%d')) = @DYil
      AND ef.Sube_ID = @Sube_ID
    GROUP BY ef.Donem
)
SELECT Donem, COALESCE(SUM(Tutar), 0) AS Toplam_Tutar
FROM tumunu_veriler
GROUP BY Donem
ORDER BY Donem;
-------------------------
Bakım Onarım


SET @DYil = Ekran.Yil;
SET @Sube_ID = Ekran.Sube_ID;

WITH MatchingKategori AS (
    SELECT Kategori_ID
    FROM SilverCloud.Kategori
    WHERE Kategori_Adi = 'Bakım Onarım'
),
tumunu_veriler AS (
    SELECT dh.Donem, SUM(dh.Tutar) AS Tutar
    FROM SilverCloud.Diger_Harcama dh
    JOIN MatchingKategori k ON dh.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(dh.Donem, '01'), '%y%m%d')) = @DYil
      AND dh.Sube_ID = @Sube_ID
    GROUP BY dh.Donem

    UNION ALL

    SELECT ef.Donem, SUM(ef.Tutar) AS Tutar
    FROM SilverCloud.e_Fatura ef
    JOIN MatchingKategori k ON ef.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(ef.Donem, '01'), '%y%m%d')) = @DYil
      AND ef.Sube_ID = @Sube_ID
    GROUP BY ef.Donem
)
SELECT Donem, COALESCE(SUM(Tutar), 0) AS Toplam_Tutar
FROM tumunu_veriler
GROUP BY Donem
ORDER BY Donem;

-------------------------
Personel Tazminat (Kıdem, İhbar vb.)


SET @DYil = Ekran.Yil;
SET @Sube_ID = Ekran.Sube_ID;

WITH MatchingKategori AS (
    SELECT Kategori_ID
    FROM SilverCloud.Kategori
    WHERE Kategori_Adi = 'Personel Tazminat (Kıdem, İhbar vb.)'
),
tumunu_veriler AS (
    SELECT dh.Donem, SUM(dh.Tutar) AS Tutar
    FROM SilverCloud.Diger_Harcama dh
    JOIN MatchingKategori k ON dh.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(dh.Donem, '01'), '%y%m%d')) = @DYil
      AND dh.Sube_ID = @Sube_ID
    GROUP BY dh.Donem

    UNION ALL

    SELECT ef.Donem, SUM(ef.Tutar) AS Tutar
    FROM SilverCloud.e_Fatura ef
    JOIN MatchingKategori k ON ef.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(ef.Donem, '01'), '%y%m%d')) = @DYil
      AND ef.Sube_ID = @Sube_ID
    GROUP BY ef.Donem
)
SELECT Donem, COALESCE(SUM(Tutar), 0) AS Toplam_Tutar
FROM tumunu_veriler
GROUP BY Donem
ORDER BY Donem;

-------------------------
İlaçlama


SET @DYil = Ekran.Yil;
SET @Sube_ID = Ekran.Sube_ID;

WITH MatchingKategori AS (
    SELECT Kategori_ID
    FROM SilverCloud.Kategori
    WHERE Kategori_Adi = 'İlaçlama'
),
tumunu_veriler AS (
    SELECT dh.Donem, SUM(dh.Tutar) AS Tutar
    FROM SilverCloud.Diger_Harcama dh
    JOIN MatchingKategori k ON dh.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(dh.Donem, '01'), '%y%m%d')) = @DYil
      AND dh.Sube_ID = @Sube_ID
    GROUP BY dh.Donem

    UNION ALL

    SELECT ef.Donem, SUM(ef.Tutar) AS Tutar
    FROM SilverCloud.e_Fatura ef
    JOIN MatchingKategori k ON ef.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(ef.Donem, '01'), '%y%m%d')) = @DYil
      AND ef.Sube_ID = @Sube_ID
    GROUP BY ef.Donem
)
SELECT Donem, COALESCE(SUM(Tutar), 0) AS Toplam_Tutar
FROM tumunu_veriler
GROUP BY Donem
ORDER BY Donem;

-----------------------------
Baca Temizliği


SET @DYil = Ekran.Yil;
SET @Sube_ID = Ekran.Sube_ID;

WITH MatchingKategori AS (
    SELECT Kategori_ID
    FROM SilverCloud.Kategori
    WHERE Kategori_Adi = 'Baca Temizliği'
),
tumunu_veriler AS (
    SELECT dh.Donem, SUM(dh.Tutar) AS Tutar
    FROM SilverCloud.Diger_Harcama dh
    JOIN MatchingKategori k ON dh.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(dh.Donem, '01'), '%y%m%d')) = @DYil
      AND dh.Sube_ID = @Sube_ID
    GROUP BY dh.Donem

    UNION ALL

    SELECT ef.Donem, SUM(ef.Tutar) AS Tutar
    FROM SilverCloud.e_Fatura ef
    JOIN MatchingKategori k ON ef.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(ef.Donem, '01'), '%y%m%d')) = @DYil
      AND ef.Sube_ID = @Sube_ID
    GROUP BY ef.Donem
)
SELECT Donem, COALESCE(SUM(Tutar), 0) AS Toplam_Tutar
FROM tumunu_veriler
GROUP BY Donem
ORDER BY Donem;

-----------------------------
ÇTV, İşgaliye, İlan Reklam Vergi Bedelleri


SET @DYil = Ekran.Yil;
SET @Sube_ID = Ekran.Sube_ID;

WITH MatchingKategori AS (
    SELECT Kategori_ID
    FROM SilverCloud.Kategori
    WHERE Kategori_Adi = 'ÇTV, İşgaliye, İlan Reklam Vergi Bedelleri'
),
tumunu_veriler AS (
    SELECT dh.Donem, SUM(dh.Tutar) AS Tutar
    FROM SilverCloud.Diger_Harcama dh
    JOIN MatchingKategori k ON dh.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(dh.Donem, '01'), '%y%m%d')) = @DYil
      AND dh.Sube_ID = @Sube_ID
    GROUP BY dh.Donem

    UNION ALL

    SELECT ef.Donem, SUM(ef.Tutar) AS Tutar
    FROM SilverCloud.e_Fatura ef
    JOIN MatchingKategori k ON ef.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(ef.Donem, '01'), '%y%m%d')) = @DYil
      AND ef.Sube_ID = @Sube_ID
    GROUP BY ef.Donem
)
SELECT Donem, COALESCE(SUM(Tutar), 0) AS Toplam_Tutar
FROM tumunu_veriler
GROUP BY Donem
ORDER BY Donem;

-----------------------------
Kırtasiye


SET @DYil = Ekran.Yil;
SET @Sube_ID = Ekran.Sube_ID;

WITH MatchingKategori AS (
    SELECT Kategori_ID
    FROM SilverCloud.Kategori
    WHERE Kategori_Adi = 'Kırtasiye'
),
tumunu_veriler AS (
    SELECT dh.Donem, SUM(dh.Tutar) AS Tutar
    FROM SilverCloud.Diger_Harcama dh
    JOIN MatchingKategori k ON dh.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(dh.Donem, '01'), '%y%m%d')) = @DYil
      AND dh.Sube_ID = @Sube_ID
    GROUP BY dh.Donem

    UNION ALL

    SELECT ef.Donem, SUM(ef.Tutar) AS Tutar
    FROM SilverCloud.e_Fatura ef
    JOIN MatchingKategori k ON ef.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(ef.Donem, '01'), '%y%m%d')) = @DYil
      AND ef.Sube_ID = @Sube_ID
    GROUP BY ef.Donem
)
SELECT Donem, COALESCE(SUM(Tutar), 0) AS Toplam_Tutar
FROM tumunu_veriler
GROUP BY Donem
ORDER BY Donem;


-----------------------------
Müşavirlik Ücreti


SET @DYil = Ekran.Yil;
SET @Sube_ID = Ekran.Sube_ID;

WITH MatchingKategori AS (
    SELECT Kategori_ID
    FROM SilverCloud.Kategori
    WHERE Kategori_Adi = 'Müşavirlik Ücreti'
),
tumunu_veriler AS (
    SELECT dh.Donem, SUM(dh.Tutar) AS Tutar
    FROM SilverCloud.Diger_Harcama dh
    JOIN MatchingKategori k ON dh.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(dh.Donem, '01'), '%y%m%d')) = @DYil
      AND dh.Sube_ID = @Sube_ID
    GROUP BY dh.Donem

    UNION ALL

    SELECT ef.Donem, SUM(ef.Tutar) AS Tutar
    FROM SilverCloud.e_Fatura ef
    JOIN MatchingKategori k ON ef.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(ef.Donem, '01'), '%y%m%d')) = @DYil
      AND ef.Sube_ID = @Sube_ID
    GROUP BY ef.Donem
)
SELECT Donem, COALESCE(SUM(Tutar), 0) AS Toplam_Tutar
FROM tumunu_veriler
GROUP BY Donem
ORDER BY Donem;
-----------------------------
HIJYEN DENETİMİ

SET @DYil = Ekran.Yil;
SET @Sube_ID = Ekran.Sube_ID;

WITH MatchingKategori AS (
    SELECT Kategori_ID
    FROM SilverCloud.Kategori
    WHERE Kategori_Adi = 'Hijyen / Gizli Müşteri Denetimi'
),
tumunu_veriler AS (
    SELECT dh.Donem, SUM(dh.Tutar) AS Tutar
    FROM SilverCloud.Diger_Harcama dh
    JOIN MatchingKategori k ON dh.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(dh.Donem, '01'), '%y%m%d')) = @DYil
      AND dh.Sube_ID = @Sube_ID
    GROUP BY dh.Donem

    UNION ALL

    SELECT ef.Donem, SUM(ef.Tutar) AS Tutar
    FROM SilverCloud.e_Fatura ef
    JOIN MatchingKategori k ON ef.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(ef.Donem, '01'), '%y%m%d')) = @DYil
      AND ef.Sube_ID = @Sube_ID
    GROUP BY ef.Donem
)
SELECT Donem, COALESCE(SUM(Tutar), 0) AS Toplam_Tutar
FROM tumunu_veriler
GROUP BY Donem
ORDER BY Donem;

-----------------------------
İşyeri Sigorta Gideri

SET @DYil = Ekran.Yil;
SET @Sube_ID = Ekran.Sube_ID;

WITH MatchingKategori AS (
    SELECT Kategori_ID
    FROM SilverCloud.Kategori
    WHERE Kategori_Adi = 'İşyeri Sigorta Gideri'
),
tumunu_veriler AS (
    SELECT dh.Donem, SUM(dh.Tutar) AS Tutar
    FROM SilverCloud.Diger_Harcama dh
    JOIN MatchingKategori k ON dh.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(dh.Donem, '01'), '%y%m%d')) = @DYil
      AND dh.Sube_ID = @Sube_ID
    GROUP BY dh.Donem

    UNION ALL

    SELECT ef.Donem, SUM(ef.Tutar) AS Tutar
    FROM SilverCloud.e_Fatura ef
    JOIN MatchingKategori k ON ef.Kategori_ID = k.Kategori_ID
    WHERE YEAR(STR_TO_DATE(CONCAT(ef.Donem, '01'), '%y%m%d')) = @DYil
      AND ef.Sube_ID = @Sube_ID
    GROUP BY ef.Donem
)
SELECT Donem, COALESCE(SUM(Tutar), 0) AS Toplam_Tutar
FROM tumunu_veriler
GROUP BY Donem
ORDER BY Donem;
